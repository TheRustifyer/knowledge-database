From here I'll assume that you've followed the instructions of the [[001. Mini PC with Manjaro]] doc and logged from any machine via *SSH* to the *server*.

## Adding my SSH id25519 pair of keys üîë

We'll need secure authentication. And I use my own keys. I store the raw content securely on `Vaultwarden` and the whole files on `Seafile`. 

### Start the *SSH agent* in the background

```shell
‚îå‚îÄ> Ôåí  vv at Ó¨Å vv-minipc in @192.168.10.95 ~
‚ùØ eval "$(ssh-agent -s)"
Agent pid 3193
```

### Create the private and public key pair

```bash
touch ~/.ssh/the_rustifyer
touch ~/.ssh/the_rustifyer.pub
```

### Add the private-public keys to the files

Choose whatever you prefer to add the keys. One option is just to open them with the editor and copy-pasting the content in there.

### Alternative: Copy them from the Seafile secure library üìï

I have an encrypted and securized `Seafile` library that helds sensitive files and information.
You can just copy them into the `.ssh` folder.

```bash
cp ~/media/seafile/sensitive/ssh/the_rustifyer ~/.ssh/the_rustifyer
cp ~/media/seafile/sensitive/ssh/the_rustifyer.pub ~/.ssh/the_rustifyer.pub
```

### Private key permissions ‚ö†Ô∏è

SSH requires private keys to be **only accessible by the owner** (`0600` or stricter).

```bash
sudo chmod 600 ~/.ssh/the_rustifyer
```

### Add the key to the SSH agent

```bash
ssh-add ~/.ssh/the_rustifyer
```

You should see something like:

```bash
‚îå‚îÄ> Ôåí  vv at Ó¨Å vv-minipc in @192.168.10.95 ~
‚ùØ ssh-add ~/.ssh/the_rustifyer
Enter passphrase for /home/vv/.ssh/the_rustifyer:
Identity added: /home/vv/.ssh/the_rustifyer (The Rustifyer (alex.vergara@tuta.io))
```

## Create dhparams file

As a fair warning, this file will take a while to generate.  
If you don‚Äôt have the ssl subdirectory, you can either create it, or update the config below to use a different folder.

```bash
sudo openssl dhparam -out ~/.hosted/certs/dhparams.pem 2048
```
## Adding Yay üì¶

We'll need some packages that aren't on the *Arch Linux* base nor extra repositories.
But they may be on the `Aur` repos. For that, we'll be using `yay`, a package manager for the *aur* repositories

```bash
sudo pacman -S yay
```

## Install Rust-lang ü¶Ä

```bash
`curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh`
```

## Install Golang

```bash
sudo pacman -S go
```

## Install Docker üêã

```bash

```

> [!NOTE]
> On the `dockerd` command line, the options are the same, `--dns XX.XX.1.1 --dns-search companydomain`. To avoid changing the startup scripts to add that option, it's easier to setup an /etc/docker/daemon.json file with the following contents:

```
{
  "dns": ["XX.XX.1.1"],
  "dns-search": ["companydomain"]
}
```

Then restart the docker daemon with `systemctl restart docker` to apply the change.

## Build dependencies üõ†Ô∏è

Some of the things that we will be installing requires some packages in order to be built.
Let's go ahead and *catch them all!*

```bash
sudo pacman -S base-devel gcc-multilib lib32-gcc-libs cmake
```


## Terminal editor üñ•Ô∏è

Yes. You've guessed it! We will be using `Neovim` as our terminal editor.

```bash
sudo pacman -S neovim
```

### Overpowering Neovim

```bash
git clone git@github.com:/TheRustifyer/nvim-config ~/.config/nvim
```


### Clipboards üìé

In order to copy content from `Neovim` to the shell in a *SSH* session, will need to give it a `clipboard provider`. We will be using [Lemonade](https://github.com/lemonade-command/lemonade)

> WARNING ‚ö†Ô∏è
> Installation on the docs is deprecated for newer versions of `Golang`, so just type the command below

```bash
go install github.com/lemonade-command/lemonade@latest
```
## Assign an IP via system configuration üåê

I'd like to assign a particular *IP* address to my devices depending on their type, characteristics...
The one that I use as a main server, will always be on the `192.168.10.10`.

There's two options here:
- Assign on the router the *IP* via some rewrite tool, so it will be assigned via **DHCP**
- Manually configure the system to have the desired *IP*

Both aren't mutually exclusive, and I'll typically do both. But since the router's one depends on the router, and can easily be configured via the web interface, I'll document here how to assign the desired *IP* to a system that is running `Manjaro`.

// TODO:

## SSL certificates

## Generating self-signed certificates

In order to enable `TLS` communication, we need that transmissions to be secured and encrypted. Some of the tools of our ***homelab*** requires cyphered connections to be fully-functional. And even if the requests are made within our home networking, is anyway good practice, because anyone connected to your home net could sniff the data in the communications as they are sent as plain text.

In **Manjaro** **to** import a local crt you must first store the cert with the trust command that allow manage the policy store items.

```
sudo trust anchor /path/to/the/root.crt
sudo update-ca-trust
```

now in the store you run the update-**ca**-trust to finish. You don't need to do anything else.

### Installing the required dependencies

```bash
sudo pacman -S certbot python-pyopenssl
pipx certbot-dns-duckdns --include-deps
```

### Using the 01 ACME challenge to validate them // TODO

## Adding the ones from duckdns

```bash
sudo mkdir -p /usr/share/ca-certificates/alexvergara.duckdns.org
sudo cp -r ~/.hosted/certs/alexvergara.duckdns.org /usr/share/ca-certificates/alexvergara.duckdns.org
sudo trust extract-compat
```

