## Introduction

LLDAP (Lightweight LDAP) requires a dedicated system user and group to run securely. This guide provides step-by-step instructions to create the `lldap` user and group on a Manjaro system, ensuring proper permissions and security settings.

## Installation and configuration

### 1. Create the `lldap` Group

```bash
sudo groupadd --system lldap
```

This command creates a system group named `lldap`.

### 2. Create the `lldap` User

```bash
sudo useradd --system --gid lldap --home /var/lib/lldap --shell /usr/bin/nologin lldap
```

- `--system`: Creates a system user.
    
- `--gid lldap`: Assigns the user to the `lldap` group.
    
- `--home /var/lib/lldap`: Sets the home directory (adjust if needed).
    
- `--shell /usr/bin/nologin`: Prevents direct login for security.

#### 1. Set Proper Permissions

Ensure that the `/var/lib/lldap` directory exists and is owned by the `lldap` user:

```bash
sudo mkdir -p /var/lib/lldap
sudo chown -R lldap:lldap /var/lib/lldap
sudo chmod 750 /var/lib/lldap
```

This ensures that only `lldap` and system administrators can access the directory.

#### 2. Verify the User and Directory

To confirm that the `lldap` user and group were created successfully, run:

```bash
id lldap
ls -ld /var/lib/lldap
```

These commands should display information about the `lldap` user, group, and directory permissions.

### 3. Install LLDAP

```bash
sudo pacman -S openldap sssd --noconfirm --needed
yay -S lldap-bin --noconfirm --needed
```

### 4. Copy the configuration

```bash
sudo cp -f ~/.hosted/security/lldap/lldap.toml /etc/lldap
```

### 5.  Enable the service

```bash
sudo systemctl enable --now lldap.service
```

### 6. Allow to read the user's home for the certificates

```bash
sudo nvim /usr/lib/systemd/system/lldap.service
```

And now look for the line: `ProtectUserHome: yes` and change it to ***no***.

### 7. Restart the daemon and the service

Since we've changed the service file, we need to reload the **systemd** daemon and reload the service

```bash
sudo systemctl daemon-reload
sudo systemctl restart lldap.service
sudo systemctl status lldap.service
```

# Final steps

Now go to the [lldap](https://lldap.home.lab) *url* and login with the *admin* user and the *admin* password, and *voil√°*, the ***LLDAP*** service is ready to be your lightweight and fast **ldap** implementation.
